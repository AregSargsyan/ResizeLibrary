import { EventEmitter, Output, Directive, ElementRef, Renderer2, NgZone } from '@angular/core';
import { fromEvent, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
export class ResizableDirective {
    constructor(renderer, elementRef, zone) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.zone = zone;
        this.isGrabbing = false;
        this.previousX = 0;
        this.previousY = 0;
        this.hostLeft = 0;
        this.hostLeftMargin = 0;
        this.hostRight = 0;
        this.hostRightMargin = 0;
        this.hostTop = 0;
        this.hostTopMargin = 0;
        this.hostBottom = 0;
        this.hostBottomMargin = 0;
        this.hostMaxWidth = 0;
        this.hostMinWidth = 0;
        this.hostMaxHeight = 0;
        this.hostMinHeight = 0;
        this.onDestroy$ = new Subject();
        this.resizingStart = new EventEmitter();
        this.resizingElement = new EventEmitter();
        this.resizingEnd = new EventEmitter();
    }
    mouseMoveOnElement(event) {
        const elRightBorder = this.hostCoordinates.right;
        const elLeftBorder = this.hostCoordinates.left;
        const elTopBorder = this.hostCoordinates.top;
        const elBottomBorder = this.hostCoordinates.bottom;
        if ((elRightBorder - event.clientX) < 10 && (elRightBorder - event.clientX) > -10 && !this.isGrabbing) {
            if ((elTopBorder - event.clientY) < 10 && (elTopBorder - event.clientY) > -10) {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'nesw-resize');
                this.mouseOnBorder = 'top_right';
            }
            else if ((elBottomBorder - event.clientY) < 10 && (elBottomBorder - event.clientY) > -10) {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'se-resize');
                this.mouseOnBorder = 'bottom_right';
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'e-resize');
                this.mouseOnBorder = 'right';
            }
        }
        else if ((elBottomBorder - event.clientY) < 10 && (elBottomBorder - event.clientY) > -10 && !this.isGrabbing) {
            if ((elLeftBorder - event.clientX) < 10 && (elLeftBorder - event.clientX) > -10) {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'nesw-resize');
                this.mouseOnBorder = 'bottom_left';
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 's-resize');
                this.mouseOnBorder = 'bottom';
            }
        }
        else if ((elLeftBorder - event.clientX) < 10 && (elLeftBorder - event.clientX) > -10 && !this.isGrabbing) {
            if ((elTopBorder - event.clientY) < 10 && (elTopBorder - event.clientY) > -10) {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'se-resize');
                this.mouseOnBorder = 'top_left';
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 'e-resize');
                this.mouseOnBorder = 'left';
            }
        }
        else if ((elTopBorder - event.clientY) < 10 && (elTopBorder - event.clientY) > -10 && !this.isGrabbing) {
            this.renderer.setStyle(this.elementRef.nativeElement, 'cursor', 's-resize');
            this.mouseOnBorder = 'top';
        }
        else if (!this.isGrabbing) {
            this.renderer.removeStyle(this.elementRef.nativeElement, 'cursor');
            this.mouseOnBorder = false;
        }
        this.hostCoordinates = this.elementRef.nativeElement.getBoundingClientRect();
    }
    onMouseDown(event) {
        if (this.mouseOnBorder) {
            this.hostWidth = parseFloat(getComputedStyle(this.elementRef.nativeElement).width);
            this.hostHeight = parseFloat(getComputedStyle(this.elementRef.nativeElement).height);
            this.hostLeft = parseFloat(getComputedStyle(this.elementRef.nativeElement).left);
            this.hostRight = parseFloat(getComputedStyle(this.elementRef.nativeElement).right);
            this.hostLeftMargin = parseFloat(getComputedStyle(this.elementRef.nativeElement).marginLeft);
            this.hostRightMargin = parseFloat(getComputedStyle(this.elementRef.nativeElement).marginRight);
            this.hostTop = parseFloat(getComputedStyle(this.elementRef.nativeElement).top);
            this.hostTopMargin = parseFloat(getComputedStyle(this.elementRef.nativeElement).marginTop);
            this.hostBottom = parseFloat(getComputedStyle(this.elementRef.nativeElement).bottom);
            this.hostBottomMargin = parseFloat(getComputedStyle(this.elementRef.nativeElement).marginBottom);
            this.hostMaxWidth = parseFloat(getComputedStyle(this.elementRef.nativeElement).maxWidth);
            this.hostMinWidth = parseFloat(getComputedStyle(this.elementRef.nativeElement).minWidth);
            this.hostMaxHeight = parseFloat(getComputedStyle(this.elementRef.nativeElement).maxHeight);
            this.hostMinHeight = parseFloat(getComputedStyle(this.elementRef.nativeElement).minHeight);
            this.isGrabbing = true;
            this.previousX = event.clientX;
            this.previousY = event.clientY;
            this.resizingStart.emit(this.outputData(event));
            event.preventDefault();
        }
    }
    onMouseMove(event) {
        if (this.isGrabbing && this.mouseOnBorder) {
            if (this.mouseOnBorder == 'top') {
                this.resizeElementFromTheTop(event);
            }
            else if (this.mouseOnBorder == 'bottom') {
                this.resizeElementFromTheBottom(event);
            }
            else if (this.mouseOnBorder == 'left') {
                this.resizeElementFromTheLeft(event);
            }
            else if (this.mouseOnBorder == 'right') {
                this.resizeElementFromTheRight(event);
            }
            else if (this.mouseOnBorder == 'top_left') {
                this.resizeElementFromTheLeft(event);
                this.resizeElementFromTheTop(event);
            }
            else if (this.mouseOnBorder == 'top_right') {
                this.resizeElementFromTheRight(event);
                this.resizeElementFromTheTop(event);
            }
            else if (this.mouseOnBorder == 'bottom_right') {
                this.resizeElementFromTheRight(event);
                this.resizeElementFromTheBottom(event);
            }
            else if (this.mouseOnBorder == 'bottom_left') {
                this.resizeElementFromTheLeft(event);
                this.resizeElementFromTheBottom(event);
            }
            this.resizingElement.emit(this.outputData(event));
        }
        this.hostCoordinates = this.elementRef.nativeElement.getBoundingClientRect();
    }
    resizeElementFromTheBottom(event) {
        this.hostHeight += event.clientY - this.previousY;
        this.hostBottom -= event.clientY - this.previousY;
        this.hostBottomMargin -= event.clientY - this.previousY;
        this.previousY = event.clientY;
        if (this.hostHeight < 0 || this.hostHeight < this.hostMinHeight || this.hostHeight > this.hostMaxHeight)
            return;
        else {
            this.renderer.setStyle(this.elementRef.nativeElement, 'height', `${this.hostHeight}px`);
            if (getComputedStyle(this.elementRef.nativeElement).position == 'absolute' || getComputedStyle(this.elementRef.nativeElement).position == "fixed") {
                this.renderer.setStyle(this.elementRef.nativeElement, 'bottom', `${this.hostBottom}px`);
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'margin-bottom', `${this.hostBottomMargin}px`);
            }
        }
    }
    resizeElementFromTheTop(event) {
        this.hostHeight -= event.clientY - this.previousY;
        this.hostTop += event.clientY - this.previousY;
        this.hostTopMargin += event.clientY - this.previousY;
        this.previousY = event.clientY;
        if (this.hostHeight < 0 || this.hostHeight < this.hostMinHeight || this.hostHeight > this.hostMaxHeight)
            return;
        else {
            this.renderer.setStyle(this.elementRef.nativeElement, 'height', `${this.hostHeight}px`);
            if (getComputedStyle(this.elementRef.nativeElement).position == 'absolute' || getComputedStyle(this.elementRef.nativeElement).position == "fixed") {
                this.renderer.setStyle(this.elementRef.nativeElement, 'top', `${this.hostTop}px`);
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'margin-top', `${this.hostTopMargin}px`);
            }
        }
    }
    resizeElementFromTheRight(event) {
        this.hostWidth += event.clientX - this.previousX;
        this.hostRight -= event.clientX - this.previousX;
        this.hostRightMargin -= event.clientX - this.previousX;
        this.previousX = event.clientX;
        if (this.hostWidth < 0 || this.hostWidth < this.hostMinWidth || this.hostWidth > this.hostMaxWidth)
            return;
        else {
            this.renderer.setStyle(this.elementRef.nativeElement, 'width', `${this.hostWidth}px`);
            if (getComputedStyle(this.elementRef.nativeElement).position == 'absolute' || getComputedStyle(this.elementRef.nativeElement).position == "fixed") {
                this.renderer.setStyle(this.elementRef.nativeElement, 'right', `${this.hostRight}px`);
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'margin-right', `${this.hostRightMargin}px`);
            }
        }
    }
    resizeElementFromTheLeft(event) {
        this.hostWidth -= event.clientX - this.previousX;
        this.hostLeft += event.clientX - this.previousX;
        this.hostLeftMargin += event.clientX - this.previousX;
        this.previousX = event.clientX;
        if (this.hostWidth <= 0 || this.hostWidth <= this.hostMinWidth || this.hostWidth >= this.hostMaxWidth)
            return;
        else {
            this.renderer.setStyle(this.elementRef.nativeElement, 'width', `${this.hostWidth}px`);
            if (getComputedStyle(this.elementRef.nativeElement).position == 'absolute' || getComputedStyle(this.elementRef.nativeElement).position == "fixed") {
                this.renderer.setStyle(this.elementRef.nativeElement, 'left', `${this.hostLeft}px`);
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'margin-left', `${this.hostLeftMargin}px`);
            }
        }
    }
    onMouseUp(event) {
        if (this.isGrabbing) {
            this.resizingEnd.emit(this.outputData(event));
            this.isGrabbing = false;
        }
    }
    outputData(event) {
        return {
            elementStyles: getComputedStyle(this.elementRef.nativeElement),
            mouseevent: event
        };
    }
    setSubscriptions() {
        this.mouseMoveOnElement$ = fromEvent(this.elementRef.nativeElement, 'mousemove')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((event) => this.mouseMoveOnElement(event));
        this.mouseDownOnElement$ = fromEvent(this.elementRef.nativeElement, 'mousedown')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((event) => this.onMouseDown(event));
        this.mouseMoveonDocument$ = fromEvent(document, 'mousemove')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((event) => this.onMouseMove(event));
        this.mouseUpOnDocument$ = fromEvent(document, 'mouseup')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((event) => this.onMouseUp(event));
    }
    ngOnInit() {
        this.hostCoordinates = this.elementRef.nativeElement.getBoundingClientRect();
        this.zone.runOutsideAngular(() => this.setSubscriptions());
    }
    ngOnDestroy() {
        this.onDestroy$.next();
        this.onDestroy$.complete();
    }
}
ResizableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[resizable]',
            },] }
];
ResizableDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
ResizableDirective.propDecorators = {
    resizingStart: [{ type: Output }],
    resizingElement: [{ type: Output }],
    resizingEnd: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzaXphYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9BcmVnL0Rlc2t0b3AvUmV1c2FibGVEaXJla3Rpdk5QTS9teS13b3Jrc3BhY2UvcHJvamVjdHMvYW5ndWxhci1lbGVtZW50cy1yZXNpemVyL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9yZXNpemFibGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUMsTUFBTSxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RixPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBYTNDLE1BQU0sT0FBTyxrQkFBa0I7SUErQjdCLFlBQW9CLFFBQW1CLEVBQVUsVUFBc0IsRUFBVSxJQUFZO1FBQXpFLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBUTtRQTVCN0YsZUFBVSxHQUFZLEtBQUssQ0FBQTtRQUczQixjQUFTLEdBQVcsQ0FBQyxDQUFBO1FBQ3JCLGNBQVMsR0FBVyxDQUFDLENBQUE7UUFDckIsYUFBUSxHQUFXLENBQUMsQ0FBQTtRQUNwQixtQkFBYyxHQUFXLENBQUMsQ0FBQTtRQUMxQixjQUFTLEdBQVcsQ0FBQyxDQUFBO1FBQ3JCLG9CQUFlLEdBQVcsQ0FBQyxDQUFBO1FBQzNCLFlBQU8sR0FBVyxDQUFDLENBQUE7UUFDbkIsa0JBQWEsR0FBVyxDQUFDLENBQUE7UUFDekIsZUFBVSxHQUFXLENBQUMsQ0FBQTtRQUN0QixxQkFBZ0IsR0FBVyxDQUFDLENBQUE7UUFDNUIsaUJBQVksR0FBVyxDQUFDLENBQUE7UUFDeEIsaUJBQVksR0FBVyxDQUFDLENBQUE7UUFDeEIsa0JBQWEsR0FBVyxDQUFDLENBQUE7UUFDekIsa0JBQWEsR0FBVyxDQUFDLENBQUE7UUFNekIsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFFdkIsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBa0IsQ0FBQTtRQUNsRCxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFrQixDQUFBO1FBQ3BELGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQWtCLENBQUE7SUFFdUMsQ0FBQztJQUUxRixrQkFBa0IsQ0FBQyxLQUFpQjtRQUUxQyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQTtRQUNoRCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQTtRQUM5QyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQTtRQUM1QyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQTtRQUVsRCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNyRyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFO2dCQUM3RSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsYUFBYSxDQUFDLENBQUE7Z0JBQzlFLElBQUksQ0FBQyxhQUFhLEdBQUcsV0FBVyxDQUFBO2FBQ2pDO2lCQUNJLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3hGLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQTtnQkFDNUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxjQUFjLENBQUE7YUFDcEM7aUJBQ0k7Z0JBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFBO2dCQUMzRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQTthQUM3QjtTQUNGO2FBRUksSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDNUcsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRTtnQkFDL0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsUUFBUSxFQUFFLGFBQWEsQ0FBQyxDQUFBO2dCQUM5RSxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQTthQUNuQztpQkFDSTtnQkFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUE7Z0JBQzNFLElBQUksQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFBO2FBQzlCO1NBQ0Y7YUFFSSxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUN4RyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFO2dCQUM3RSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUE7Z0JBQzVFLElBQUksQ0FBQyxhQUFhLEdBQUcsVUFBVSxDQUFBO2FBQ2hDO2lCQUNJO2dCQUNILElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQTtnQkFDM0UsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUE7YUFDNUI7U0FDRjthQUVJLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3RHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQTtZQUMzRSxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQTtTQUMzQjthQUVJLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFBO1lBQ2xFLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFBO1NBQzNCO1FBQ0QsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9FLENBQUM7SUFFTyxXQUFXLENBQUMsS0FBaUI7UUFDbkMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDbEYsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUNwRixJQUFJLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ2hGLElBQUksQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDbEYsSUFBSSxDQUFDLGNBQWMsR0FBRyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUM1RixJQUFJLENBQUMsZUFBZSxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1lBQzlGLElBQUksQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDOUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUMxRixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBQ3BGLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQTtZQUNoRyxJQUFJLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1lBQ3hGLElBQUksQ0FBQyxZQUFZLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDeEYsSUFBSSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUMxRixJQUFJLENBQUMsYUFBYSxHQUFHLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1lBQzFGLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO1lBQ3RCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtZQUM5QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUE7WUFDOUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQy9DLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQTtTQUN2QjtJQUNILENBQUM7SUFJTyxXQUFXLENBQUMsS0FBaUI7UUFDbkMsSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDekMsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLEtBQUssRUFBRTtnQkFDL0IsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3BDO2lCQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxRQUFRLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQTthQUN2QztpQkFDSSxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksTUFBTSxFQUFFO2dCQUNyQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDckM7aUJBQ0ksSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLE9BQU8sRUFBRTtnQkFDdEMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3RDO2lCQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxVQUFVLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDcEMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3BDO2lCQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxXQUFXLEVBQUU7Z0JBQzFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3BDO2lCQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxjQUFjLEVBQUU7Z0JBQzdDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3ZDO2lCQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLEVBQUU7Z0JBQzVDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDcEMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3ZDO1lBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1NBQ2xEO1FBQ0QsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9FLENBQUM7SUFFTywwQkFBMEIsQ0FBQyxLQUFpQjtRQUNsRCxJQUFJLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUNqRCxJQUFJLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUNqRCxJQUFJLENBQUMsZ0JBQWdCLElBQUksS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1FBQ3ZELElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUM5QixJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhO1lBQUUsT0FBTTthQUMxRztZQUNILElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksQ0FBQyxDQUFBO1lBQ3ZGLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxRQUFRLElBQUksVUFBVSxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxJQUFJLE9BQU8sRUFBRTtnQkFDakosSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUE7YUFDeEY7aUJBQ0k7Z0JBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsZUFBZSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixJQUFJLENBQUMsQ0FBQTthQUNyRztTQUNGO0lBQ0gsQ0FBQztJQUVPLHVCQUF1QixDQUFDLEtBQWlCO1FBQy9DLElBQUksQ0FBQyxVQUFVLElBQUksS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1FBQ2pELElBQUksQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1FBQzlDLElBQUksQ0FBQyxhQUFhLElBQUksS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1FBQ3BELElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUM5QixJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhO1lBQUUsT0FBTTthQUMxRztZQUNILElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksQ0FBQyxDQUFBO1lBQ3ZGLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxRQUFRLElBQUksVUFBVSxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxJQUFJLE9BQU8sRUFBRTtnQkFDakosSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUE7YUFDbEY7aUJBQ0k7Z0JBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsWUFBWSxFQUFFLEdBQUcsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLENBQUE7YUFDL0Y7U0FDRjtJQUNILENBQUM7SUFFTyx5QkFBeUIsQ0FBQyxLQUFpQjtRQUNqRCxJQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUNoRCxJQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUNoRCxJQUFJLENBQUMsZUFBZSxJQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUN0RCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUE7UUFDOUIsSUFBSSxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWTtZQUFFLE9BQU07YUFDckc7WUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUMsQ0FBQTtZQUNyRixJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxJQUFJLFVBQVUsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsSUFBSSxPQUFPLEVBQUU7Z0JBQ2pKLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFBO2FBQ3RGO2lCQUNJO2dCQUNILElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxlQUFlLElBQUksQ0FBQyxDQUFBO2FBQ25HO1NBQ0Y7SUFDSCxDQUFDO0lBRU8sd0JBQXdCLENBQUMsS0FBaUI7UUFDaEQsSUFBSSxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7UUFDaEQsSUFBSSxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7UUFDL0MsSUFBSSxDQUFDLGNBQWMsSUFBSSxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7UUFDckQsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzlCLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFlBQVk7WUFBRSxPQUFNO2FBQ3hHO1lBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUE7WUFDckYsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsSUFBSSxVQUFVLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxRQUFRLElBQUksT0FBTyxFQUFFO2dCQUNqSixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQTthQUNwRjtpQkFDSTtnQkFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsR0FBRyxJQUFJLENBQUMsY0FBYyxJQUFJLENBQUMsQ0FBQTthQUNqRztTQUNGO0lBRUgsQ0FBQztJQUVPLFNBQVMsQ0FBQyxLQUFpQjtRQUNqQyxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1lBQzdDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFBO1NBQ3hCO0lBQ0gsQ0FBQztJQUVPLFVBQVUsQ0FBQyxLQUFLO1FBQ3RCLE9BQU87WUFDTCxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUM7WUFDOUQsVUFBVSxFQUFFLEtBQUs7U0FDbEIsQ0FBQTtJQUNILENBQUM7SUFFTyxnQkFBZ0I7UUFDdEIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUM7YUFDN0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDaEMsU0FBUyxDQUFDLENBQUMsS0FBaUIsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFDbkUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUM7YUFDN0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDaEMsU0FBUyxDQUFDLENBQUMsS0FBaUIsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBQzVELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxTQUFTLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQzthQUN6RCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUNoQyxTQUFTLENBQUMsQ0FBQyxLQUFpQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFDNUQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLFNBQVMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDO2FBQ3JELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ2hDLFNBQVMsQ0FBQyxDQUFDLEtBQWlCLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUM3RSxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ3RCLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDN0IsQ0FBQzs7O1lBcFFGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsYUFBYTthQUN4Qjs7O1lBYm1ELFNBQVM7WUFBckIsVUFBVTtZQUFhLE1BQU07Ozs0QkEwQ2xFLE1BQU07OEJBQ04sTUFBTTswQkFDTixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLE91dHB1dCxEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgdHlwZSBSZXNpemVEaXJlY3Rpb24gPSAndG9wJyB8ICdib3R0b20nIHwgJ3JpZ2h0JyB8ICdsZWZ0JyB8ICd0b3BfcmlnaHQnIHwgJ2JvdHRvbV9yaWdodCcgfCAnYm90dG9tX2xlZnQnIHwgJ3RvcF9sZWZ0JyB8IGZhbHNlXG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRJbnRlcmZhY2Uge1xuICBlbGVtZW50U3R5bGVzOiBDU1NTdHlsZURlY2xhcmF0aW9uO1xuICBtb3VzZWV2ZW50OiBNb3VzZUV2ZW50O1xufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbcmVzaXphYmxlXScsXG59KVxuXG5leHBvcnQgY2xhc3MgUmVzaXphYmxlRGlyZWN0aXZlIHtcblxuICBob3N0Q29vcmRpbmF0ZXM6IERPTVJlY3RcbiAgaXNHcmFiYmluZzogYm9vbGVhbiA9IGZhbHNlXG4gIGhvc3RXaWR0aDogbnVtYmVyXG4gIGhvc3RIZWlnaHQ6IG51bWJlclxuICBwcmV2aW91c1g6IG51bWJlciA9IDBcbiAgcHJldmlvdXNZOiBudW1iZXIgPSAwXG4gIGhvc3RMZWZ0OiBudW1iZXIgPSAwXG4gIGhvc3RMZWZ0TWFyZ2luOiBudW1iZXIgPSAwXG4gIGhvc3RSaWdodDogbnVtYmVyID0gMFxuICBob3N0UmlnaHRNYXJnaW46IG51bWJlciA9IDBcbiAgaG9zdFRvcDogbnVtYmVyID0gMFxuICBob3N0VG9wTWFyZ2luOiBudW1iZXIgPSAwXG4gIGhvc3RCb3R0b206IG51bWJlciA9IDBcbiAgaG9zdEJvdHRvbU1hcmdpbjogbnVtYmVyID0gMFxuICBob3N0TWF4V2lkdGg6IG51bWJlciA9IDBcbiAgaG9zdE1pbldpZHRoOiBudW1iZXIgPSAwXG4gIGhvc3RNYXhIZWlnaHQ6IG51bWJlciA9IDBcbiAgaG9zdE1pbkhlaWdodDogbnVtYmVyID0gMFxuICBtb3VzZU9uQm9yZGVyOiBSZXNpemVEaXJlY3Rpb25cbiAgbW91c2VNb3ZlT25FbGVtZW50JDogU3Vic2NyaXB0aW9uXG4gIG1vdXNlRG93bk9uRWxlbWVudCQ6IFN1YnNjcmlwdGlvblxuICBtb3VzZU1vdmVvbkRvY3VtZW50JDogU3Vic2NyaXB0aW9uXG4gIG1vdXNlVXBPbkRvY3VtZW50JDogU3Vic2NyaXB0aW9uXG4gIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIEBPdXRwdXQoKSByZXNpemluZ1N0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcjxFdmVudEludGVyZmFjZT4oKVxuICBAT3V0cHV0KCkgcmVzaXppbmdFbGVtZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxFdmVudEludGVyZmFjZT4oKVxuICBAT3V0cHV0KCkgcmVzaXppbmdFbmQgPSBuZXcgRXZlbnRFbWl0dGVyPEV2ZW50SW50ZXJmYWNlPigpXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgem9uZTogTmdab25lKSB7IH1cblxuICBwcml2YXRlIG1vdXNlTW92ZU9uRWxlbWVudChldmVudDogTW91c2VFdmVudCkge1xuXG4gICAgY29uc3QgZWxSaWdodEJvcmRlciA9IHRoaXMuaG9zdENvb3JkaW5hdGVzLnJpZ2h0XG4gICAgY29uc3QgZWxMZWZ0Qm9yZGVyID0gdGhpcy5ob3N0Q29vcmRpbmF0ZXMubGVmdFxuICAgIGNvbnN0IGVsVG9wQm9yZGVyID0gdGhpcy5ob3N0Q29vcmRpbmF0ZXMudG9wXG4gICAgY29uc3QgZWxCb3R0b21Cb3JkZXIgPSB0aGlzLmhvc3RDb29yZGluYXRlcy5ib3R0b21cblxuICAgIGlmICgoZWxSaWdodEJvcmRlciAtIGV2ZW50LmNsaWVudFgpIDwgMTAgJiYgKGVsUmlnaHRCb3JkZXIgLSBldmVudC5jbGllbnRYKSA+IC0xMCAmJiAhdGhpcy5pc0dyYWJiaW5nKSB7XG4gICAgICBpZiAoKGVsVG9wQm9yZGVyIC0gZXZlbnQuY2xpZW50WSkgPCAxMCAmJiAoZWxUb3BCb3JkZXIgLSBldmVudC5jbGllbnRZKSA+IC0xMCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnY3Vyc29yJywgJ25lc3ctcmVzaXplJylcbiAgICAgICAgdGhpcy5tb3VzZU9uQm9yZGVyID0gJ3RvcF9yaWdodCdcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKChlbEJvdHRvbUJvcmRlciAtIGV2ZW50LmNsaWVudFkpIDwgMTAgJiYgKGVsQm90dG9tQm9yZGVyIC0gZXZlbnQuY2xpZW50WSkgPiAtMTApIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2N1cnNvcicsICdzZS1yZXNpemUnKVxuICAgICAgICB0aGlzLm1vdXNlT25Cb3JkZXIgPSAnYm90dG9tX3JpZ2h0J1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAnZS1yZXNpemUnKVxuICAgICAgICB0aGlzLm1vdXNlT25Cb3JkZXIgPSAncmlnaHQnXG4gICAgICB9XG4gICAgfVxuXG4gICAgZWxzZSBpZiAoKGVsQm90dG9tQm9yZGVyIC0gZXZlbnQuY2xpZW50WSkgPCAxMCAmJiAoZWxCb3R0b21Cb3JkZXIgLSBldmVudC5jbGllbnRZKSA+IC0xMCAmJiAhdGhpcy5pc0dyYWJiaW5nKSB7XG4gICAgICBpZiAoKGVsTGVmdEJvcmRlciAtIGV2ZW50LmNsaWVudFgpIDwgMTAgJiYgKGVsTGVmdEJvcmRlciAtIGV2ZW50LmNsaWVudFgpID4gLTEwKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAnbmVzdy1yZXNpemUnKVxuICAgICAgICB0aGlzLm1vdXNlT25Cb3JkZXIgPSAnYm90dG9tX2xlZnQnXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2N1cnNvcicsICdzLXJlc2l6ZScpXG4gICAgICAgIHRoaXMubW91c2VPbkJvcmRlciA9ICdib3R0b20nXG4gICAgICB9XG4gICAgfVxuXG4gICAgZWxzZSBpZiAoKGVsTGVmdEJvcmRlciAtIGV2ZW50LmNsaWVudFgpIDwgMTAgJiYgKGVsTGVmdEJvcmRlciAtIGV2ZW50LmNsaWVudFgpID4gLTEwICYmICF0aGlzLmlzR3JhYmJpbmcpIHtcbiAgICAgIGlmICgoZWxUb3BCb3JkZXIgLSBldmVudC5jbGllbnRZKSA8IDEwICYmIChlbFRvcEJvcmRlciAtIGV2ZW50LmNsaWVudFkpID4gLTEwKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAnc2UtcmVzaXplJylcbiAgICAgICAgdGhpcy5tb3VzZU9uQm9yZGVyID0gJ3RvcF9sZWZ0J1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAnZS1yZXNpemUnKVxuICAgICAgICB0aGlzLm1vdXNlT25Cb3JkZXIgPSAnbGVmdCdcbiAgICAgIH1cbiAgICB9XG5cbiAgICBlbHNlIGlmICgoZWxUb3BCb3JkZXIgLSBldmVudC5jbGllbnRZKSA8IDEwICYmIChlbFRvcEJvcmRlciAtIGV2ZW50LmNsaWVudFkpID4gLTEwICYmICF0aGlzLmlzR3JhYmJpbmcpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAncy1yZXNpemUnKVxuICAgICAgdGhpcy5tb3VzZU9uQm9yZGVyID0gJ3RvcCdcbiAgICB9XG5cbiAgICBlbHNlIGlmICghdGhpcy5pc0dyYWJiaW5nKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnY3Vyc29yJylcbiAgICAgIHRoaXMubW91c2VPbkJvcmRlciA9IGZhbHNlXG4gICAgfVxuICAgIHRoaXMuaG9zdENvb3JkaW5hdGVzID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIH1cblxuICBwcml2YXRlIG9uTW91c2VEb3duKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMubW91c2VPbkJvcmRlcikge1xuICAgICAgdGhpcy5ob3N0V2lkdGggPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLndpZHRoKVxuICAgICAgdGhpcy5ob3N0SGVpZ2h0ID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5oZWlnaHQpXG4gICAgICB0aGlzLmhvc3RMZWZ0ID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5sZWZ0KVxuICAgICAgdGhpcy5ob3N0UmlnaHQgPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnJpZ2h0KVxuICAgICAgdGhpcy5ob3N0TGVmdE1hcmdpbiA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkubWFyZ2luTGVmdClcbiAgICAgIHRoaXMuaG9zdFJpZ2h0TWFyZ2luID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5tYXJnaW5SaWdodClcbiAgICAgIHRoaXMuaG9zdFRvcCA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkudG9wKVxuICAgICAgdGhpcy5ob3N0VG9wTWFyZ2luID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5tYXJnaW5Ub3ApXG4gICAgICB0aGlzLmhvc3RCb3R0b20gPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLmJvdHRvbSlcbiAgICAgIHRoaXMuaG9zdEJvdHRvbU1hcmdpbiA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkubWFyZ2luQm90dG9tKVxuICAgICAgdGhpcy5ob3N0TWF4V2lkdGggPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLm1heFdpZHRoKVxuICAgICAgdGhpcy5ob3N0TWluV2lkdGggPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLm1pbldpZHRoKVxuICAgICAgdGhpcy5ob3N0TWF4SGVpZ2h0ID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5tYXhIZWlnaHQpXG4gICAgICB0aGlzLmhvc3RNaW5IZWlnaHQgPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLm1pbkhlaWdodClcbiAgICAgIHRoaXMuaXNHcmFiYmluZyA9IHRydWVcbiAgICAgIHRoaXMucHJldmlvdXNYID0gZXZlbnQuY2xpZW50WFxuICAgICAgdGhpcy5wcmV2aW91c1kgPSBldmVudC5jbGllbnRZXG4gICAgICB0aGlzLnJlc2l6aW5nU3RhcnQuZW1pdCh0aGlzLm91dHB1dERhdGEoZXZlbnQpKVxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIH1cbiAgfVxuXG5cblxuICBwcml2YXRlIG9uTW91c2VNb3ZlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNHcmFiYmluZyAmJiB0aGlzLm1vdXNlT25Cb3JkZXIpIHtcbiAgICAgIGlmICh0aGlzLm1vdXNlT25Cb3JkZXIgPT0gJ3RvcCcpIHtcbiAgICAgICAgdGhpcy5yZXNpemVFbGVtZW50RnJvbVRoZVRvcChldmVudClcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMubW91c2VPbkJvcmRlciA9PSAnYm90dG9tJykge1xuICAgICAgICB0aGlzLnJlc2l6ZUVsZW1lbnRGcm9tVGhlQm90dG9tKGV2ZW50KVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGhpcy5tb3VzZU9uQm9yZGVyID09ICdsZWZ0Jykge1xuICAgICAgICB0aGlzLnJlc2l6ZUVsZW1lbnRGcm9tVGhlTGVmdChldmVudClcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMubW91c2VPbkJvcmRlciA9PSAncmlnaHQnKSB7XG4gICAgICAgIHRoaXMucmVzaXplRWxlbWVudEZyb21UaGVSaWdodChldmVudClcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMubW91c2VPbkJvcmRlciA9PSAndG9wX2xlZnQnKSB7XG4gICAgICAgIHRoaXMucmVzaXplRWxlbWVudEZyb21UaGVMZWZ0KGV2ZW50KVxuICAgICAgICB0aGlzLnJlc2l6ZUVsZW1lbnRGcm9tVGhlVG9wKGV2ZW50KVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGhpcy5tb3VzZU9uQm9yZGVyID09ICd0b3BfcmlnaHQnKSB7XG4gICAgICAgIHRoaXMucmVzaXplRWxlbWVudEZyb21UaGVSaWdodChldmVudClcbiAgICAgICAgdGhpcy5yZXNpemVFbGVtZW50RnJvbVRoZVRvcChldmVudClcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMubW91c2VPbkJvcmRlciA9PSAnYm90dG9tX3JpZ2h0Jykge1xuICAgICAgICB0aGlzLnJlc2l6ZUVsZW1lbnRGcm9tVGhlUmlnaHQoZXZlbnQpXG4gICAgICAgIHRoaXMucmVzaXplRWxlbWVudEZyb21UaGVCb3R0b20oZXZlbnQpXG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0aGlzLm1vdXNlT25Cb3JkZXIgPT0gJ2JvdHRvbV9sZWZ0Jykge1xuICAgICAgICB0aGlzLnJlc2l6ZUVsZW1lbnRGcm9tVGhlTGVmdChldmVudClcbiAgICAgICAgdGhpcy5yZXNpemVFbGVtZW50RnJvbVRoZUJvdHRvbShldmVudClcbiAgICAgIH1cbiAgICAgIHRoaXMucmVzaXppbmdFbGVtZW50LmVtaXQodGhpcy5vdXRwdXREYXRhKGV2ZW50KSlcbiAgICB9XG4gICAgdGhpcy5ob3N0Q29vcmRpbmF0ZXMgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzaXplRWxlbWVudEZyb21UaGVCb3R0b20oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICB0aGlzLmhvc3RIZWlnaHQgKz0gZXZlbnQuY2xpZW50WSAtIHRoaXMucHJldmlvdXNZXG4gICAgdGhpcy5ob3N0Qm90dG9tIC09IGV2ZW50LmNsaWVudFkgLSB0aGlzLnByZXZpb3VzWVxuICAgIHRoaXMuaG9zdEJvdHRvbU1hcmdpbiAtPSBldmVudC5jbGllbnRZIC0gdGhpcy5wcmV2aW91c1lcbiAgICB0aGlzLnByZXZpb3VzWSA9IGV2ZW50LmNsaWVudFlcbiAgICBpZiAodGhpcy5ob3N0SGVpZ2h0IDwgMCB8fCB0aGlzLmhvc3RIZWlnaHQgPCB0aGlzLmhvc3RNaW5IZWlnaHQgfHwgdGhpcy5ob3N0SGVpZ2h0ID4gdGhpcy5ob3N0TWF4SGVpZ2h0KSByZXR1cm5cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdoZWlnaHQnLCBgJHt0aGlzLmhvc3RIZWlnaHR9cHhgKVxuICAgICAgaWYgKGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnBvc2l0aW9uID09ICdhYnNvbHV0ZScgfHwgZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkucG9zaXRpb24gPT0gXCJmaXhlZFwiKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdib3R0b20nLCBgJHt0aGlzLmhvc3RCb3R0b219cHhgKVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtYXJnaW4tYm90dG9tJywgYCR7dGhpcy5ob3N0Qm90dG9tTWFyZ2lufXB4YClcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc2l6ZUVsZW1lbnRGcm9tVGhlVG9wKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5ob3N0SGVpZ2h0IC09IGV2ZW50LmNsaWVudFkgLSB0aGlzLnByZXZpb3VzWVxuICAgIHRoaXMuaG9zdFRvcCArPSBldmVudC5jbGllbnRZIC0gdGhpcy5wcmV2aW91c1lcbiAgICB0aGlzLmhvc3RUb3BNYXJnaW4gKz0gZXZlbnQuY2xpZW50WSAtIHRoaXMucHJldmlvdXNZXG4gICAgdGhpcy5wcmV2aW91c1kgPSBldmVudC5jbGllbnRZXG4gICAgaWYgKHRoaXMuaG9zdEhlaWdodCA8IDAgfHwgdGhpcy5ob3N0SGVpZ2h0IDwgdGhpcy5ob3N0TWluSGVpZ2h0IHx8IHRoaXMuaG9zdEhlaWdodCA+IHRoaXMuaG9zdE1heEhlaWdodCkgcmV0dXJuXG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5ob3N0SGVpZ2h0fXB4YClcbiAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5wb3NpdGlvbiA9PSAnYWJzb2x1dGUnIHx8IGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnBvc2l0aW9uID09IFwiZml4ZWRcIikge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndG9wJywgYCR7dGhpcy5ob3N0VG9wfXB4YClcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbWFyZ2luLXRvcCcsIGAke3RoaXMuaG9zdFRvcE1hcmdpbn1weGApXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNpemVFbGVtZW50RnJvbVRoZVJpZ2h0KGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5ob3N0V2lkdGggKz0gZXZlbnQuY2xpZW50WCAtIHRoaXMucHJldmlvdXNYXG4gICAgdGhpcy5ob3N0UmlnaHQgLT0gZXZlbnQuY2xpZW50WCAtIHRoaXMucHJldmlvdXNYXG4gICAgdGhpcy5ob3N0UmlnaHRNYXJnaW4gLT0gZXZlbnQuY2xpZW50WCAtIHRoaXMucHJldmlvdXNYXG4gICAgdGhpcy5wcmV2aW91c1ggPSBldmVudC5jbGllbnRYXG4gICAgaWYgKHRoaXMuaG9zdFdpZHRoIDwgMCB8fCB0aGlzLmhvc3RXaWR0aCA8IHRoaXMuaG9zdE1pbldpZHRoIHx8IHRoaXMuaG9zdFdpZHRoID4gdGhpcy5ob3N0TWF4V2lkdGgpIHJldHVyblxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5ob3N0V2lkdGh9cHhgKVxuICAgICAgaWYgKGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnBvc2l0aW9uID09ICdhYnNvbHV0ZScgfHwgZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkucG9zaXRpb24gPT0gXCJmaXhlZFwiKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdyaWdodCcsIGAke3RoaXMuaG9zdFJpZ2h0fXB4YClcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbWFyZ2luLXJpZ2h0JywgYCR7dGhpcy5ob3N0UmlnaHRNYXJnaW59cHhgKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVzaXplRWxlbWVudEZyb21UaGVMZWZ0KGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5ob3N0V2lkdGggLT0gZXZlbnQuY2xpZW50WCAtIHRoaXMucHJldmlvdXNYXG4gICAgdGhpcy5ob3N0TGVmdCArPSBldmVudC5jbGllbnRYIC0gdGhpcy5wcmV2aW91c1hcbiAgICB0aGlzLmhvc3RMZWZ0TWFyZ2luICs9IGV2ZW50LmNsaWVudFggLSB0aGlzLnByZXZpb3VzWFxuICAgIHRoaXMucHJldmlvdXNYID0gZXZlbnQuY2xpZW50WFxuICAgIGlmICh0aGlzLmhvc3RXaWR0aCA8PSAwIHx8IHRoaXMuaG9zdFdpZHRoIDw9IHRoaXMuaG9zdE1pbldpZHRoIHx8IHRoaXMuaG9zdFdpZHRoID49IHRoaXMuaG9zdE1heFdpZHRoKSByZXR1cm5cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIGAke3RoaXMuaG9zdFdpZHRofXB4YClcbiAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KS5wb3NpdGlvbiA9PSAnYWJzb2x1dGUnIHx8IGdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnBvc2l0aW9uID09IFwiZml4ZWRcIikge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIGAke3RoaXMuaG9zdExlZnR9cHhgKVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtYXJnaW4tbGVmdCcsIGAke3RoaXMuaG9zdExlZnRNYXJnaW59cHhgKVxuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgcHJpdmF0ZSBvbk1vdXNlVXAoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBpZiAodGhpcy5pc0dyYWJiaW5nKSB7XG4gICAgICB0aGlzLnJlc2l6aW5nRW5kLmVtaXQodGhpcy5vdXRwdXREYXRhKGV2ZW50KSlcbiAgICAgIHRoaXMuaXNHcmFiYmluZyA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvdXRwdXREYXRhKGV2ZW50KTogRXZlbnRJbnRlcmZhY2Uge1xuICAgIHJldHVybiB7XG4gICAgICBlbGVtZW50U3R5bGVzOiBnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KSxcbiAgICAgIG1vdXNlZXZlbnQ6IGV2ZW50XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRTdWJzY3JpcHRpb25zKCkge1xuICAgIHRoaXMubW91c2VNb3ZlT25FbGVtZW50JCA9IGZyb21FdmVudCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ21vdXNlbW92ZScpXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB0aGlzLm1vdXNlTW92ZU9uRWxlbWVudChldmVudCkpXG4gICAgdGhpcy5tb3VzZURvd25PbkVsZW1lbnQkID0gZnJvbUV2ZW50KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJylcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZURvd24oZXZlbnQpKVxuICAgIHRoaXMubW91c2VNb3Zlb25Eb2N1bWVudCQgPSBmcm9tRXZlbnQoZG9jdW1lbnQsICdtb3VzZW1vdmUnKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChldmVudDogTW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlTW92ZShldmVudCkpXG4gICAgdGhpcy5tb3VzZVVwT25Eb2N1bWVudCQgPSBmcm9tRXZlbnQoZG9jdW1lbnQsICdtb3VzZXVwJylcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZVVwKGV2ZW50KSlcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaG9zdENvb3JkaW5hdGVzID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuc2V0U3Vic2NyaXB0aW9ucygpKVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKVxuICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG59XG4iXX0=